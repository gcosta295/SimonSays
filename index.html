<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simon Says </title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
   
    <h1>Simon Says❤️</h1>
    <br>
    <br>
    <br>




<div id="container">
    <div id="container1">

        <button id="startb" class="thing" onclick="setTimeout(() => { showB(); },500);  playSound(4);" >Start!</button>
        <button id="rankb"  class="thing" onclick="rank(); playSound(6)" >Ranking c:</button>
        <input type="text" id="nombreInput" placeholder="Tu nombre aquí">
    </div>

    <div id="box1">   
        <button id="boton0" class="boton" onclick="playSound(0);">
            </button>
 
        <button id="boton1" class="boton" onclick="playSound(1);"></button>
    </div>
    
    <div id="box2">   
        <button id="boton2" class="boton" onclick="playSound(2);"></button>
        <button id="boton3" class="boton" onclick="playSound(3);"></button>
    </div>
</div>

<div id="container2">
    <button id="giveUp" class="thing" onclick="showB(); playSound(5);" >Give Up? :c</button>
</div>

<script type="text/javascript">
    
const boton = document.querySelectorAll(".boton");
const srcArr = ['sounds/drop.mp3', 'sounds/anvil.mp3', 'sounds/duolingo.mp3','sounds/lego.mp3', 'sounds/yoshi.mp3', 'sounds/rickroll.mp3', 'sounds/xp.mp3', 'sounds/fail.mp3'];

function playSound(num){
    var use= num+1
    const audio = new Audio(srcArr[num]);
    audio.play();
    ClickInput = num;
    const boton = document.getElementById("boton"+use);
}

function start (){
    PName = document.getElementById("nombreInput").value;
    HPoints = 0;
    PPoints = 0;
    const LNums = [];
    gameTF = true;
    game(PName, HPoints, PPoints, LNums, gameTF)
}

function compare(botonpresionado,num) {
    if (num != botonpresionado){
        gameTF=false;

    }else{
        PPoints +=10;
    }
    return (gameTF);
}

async function waitForClick() {
    return new Promise(resolve => {
        const clickHandler = (event) => {
            if (event.target.classList.contains('boton')) { 
                const clickedButton = event.target;
                const buttonId = clickedButton.id; 
                const allButtons = document.querySelectorAll('.boton'); 
                const buttonIndex = Array.from(allButtons).indexOf(clickedButton); 
                resolve(buttonIndex); 
                boton.forEach(b => b.removeEventListener('click', clickHandler)); 
            }
        };
        boton.forEach(b => b.addEventListener('click', clickHandler));
    });

}


async function game (PName, HPoints, PPoints, LNums, gameTF){
    while (gameTF==true){
        RNum = Math.floor(Math.random() *4);
        LNums.push(RNum);
        for (i = 0; i < LNums.length; i++){
            num = LNums[i];
            allButtons = document.querySelectorAll('.boton');
            botones = Array.from(allButtons);
            aja = botones[num];
            if (i == 0){
                aja.classList.add('chosen');     
                playSound(num);
            }else{
                aja.classList.add('chosen');
                setTimeout(playSound(num),800);   
            }
            await new Promise(resolve => setTimeout(resolve, 800));
            aja.classList.remove('chosen');
        }
        for (i = 0; i < LNums.length; i++){
            num = LNums[i];
            buttonIndex = await waitForClick();
            botonpresionado=buttonIndex;
            await new Promise(resolve => setTimeout(resolve, 200));
            clickedButtons = document.querySelectorAll('.myButton');
            clickedButtons.forEach(button => {button.classList.remove('active');});
            gameTF=compare(botonpresionado,num);
        }
    }
    if (HPoints < PPoints){
        HPoints = PPoints;
    }
    window.alert(HPoints);
    setTimeout(function(){playSound(7)},800);
    setTimeout(function(){showB()},1500);
    }

function showB() {
  var x = document.getElementById("box1");
  var y = document.getElementById("box2");
  var z = document.getElementById("startb");
  var q = document.getElementById("rankb");
  var w = document.getElementById("giveUp");
  var e = document.getElementById("nombreInput");

  if (z.style.display !== "none") {
    x.style.display = "flex";
    y.style.display = "flex";
    z.style.display = "none";
    q.style.display = "none";
    e.style.display = "none";
    w.style.display = "flex";
    setTimeout(function(){start()},1500);
  } else {
    x.style.display = "none";
    y.style.display = "none";
    z.style.display = "flex";
    q.style.display = "flex";
    e.style.display = "flex";
    w.style.display = "none";
  }
}

function rank() {
  var x = document.getElementById("box1");
  var y = document.getElementById("box2");
  var z = document.getElementById("startb");
  var q = document.getElementById("rankb");
  var w = document.getElementById("giveUp");
  var e = document.getElementById("nombreInput"); 
    x.style.display = "none";
    y.style.display = "none";
    z.style.display = "none";
    q.style.display = "none";
    e.style.display = "none";
    w.style.display = "none";
    setTimeout(function(){showB()},3000);
}
</script>

</body>
  
</html>